{% extends "base.html" %}
{% block title %}{{ _('4uFleet — Car rental software') }}{% endblock %}
{% from "_csrf.html" import csrf_field %}

{% block extra_head %}
<style>
  :root{
    --lp-primary:#0d6efd;
    --lp-ink:#0f172a;
    --lp-muted:#475569;
    --lp-border:#e5e7eb;
    --lp-bg:#ffffff;
    --lp-bg-soft:#f8fafc;
  }

  /* Layout base */
  .lp-section{ padding:72px 0; }
  @media (max-width: 575.98px){
    .lp-section{ padding:52px 0; }
  }

  /* HERO: estilo enterprise (clean) */
  .lp-hero{
    padding:72px 0 48px;
    background:
      linear-gradient(180deg, rgba(13,110,253,.06), rgba(255,255,255,0) 55%),
      var(--lp-bg);
    border-bottom:1px solid var(--lp-border);
  }
  @media (max-width: 575.98px){
    .lp-hero{ padding:56px 0 32px; }
  }

  .lp-badge{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px;
    border:1px solid rgba(13,110,253,.25);
    background:rgba(13,110,253,.06);
    color:#0b5ed7;
    font-weight:600;
    font-size:12px;
  }
  .lp-title{
    color:var(--lp-ink);
    letter-spacing:-.3px;
    line-height:1.08;
    font-weight:800;
    font-size:clamp(28px, 4vw, 44px);
    margin:14px 0 10px;
  }
  .lp-lead{
    color:var(--lp-muted);
    font-size:clamp(15px, 1.5vw, 18px);
    margin:0 0 18px;
  }

  /* Logo: menor e consistente no mobile */
  .lp-logo{
    max-width:240px;
    width:100%;
    height:auto;
  }
  @media (max-width: 575.98px){
    .lp-logo{ max-width:180px; }
  }

  /* Cards: minimalista, sem “efeitos” */
  .lp-card{
    background:var(--lp-bg);
    border:1px solid var(--lp-border);
    border-radius:14px;
    box-shadow: 0 1px 2px rgba(15, 23, 42, .06);
  }
  .lp-card-soft{
    background:var(--lp-bg-soft);
    border:1px solid var(--lp-border);
    border-radius:14px;
  }

  .lp-kicker{
    color:var(--lp-muted);
    font-size:12px;
    letter-spacing:.12em;
    text-transform:uppercase;
    margin-bottom:10px;
  }

  /* Ícones: simples, sem “caixinha chamativa” */
  .lp-icon{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:36px; height:36px;
    border-radius:10px;
    border:1px solid var(--lp-border);
    background:#fff;
    color:var(--lp-primary);
    flex:0 0 auto;
  }

  .lp-price{
    font-weight:800;
    letter-spacing:-.4px;
    color:var(--lp-ink);
    font-size:clamp(30px, 3vw, 40px);
    margin:6px 0;
  }

  /* Trust bar */
  .lp-trust{
    padding:18px 0;
    background:var(--lp-bg);
  }
  .lp-trust .logo-row img{ height:22px; opacity:.7; }
  .lp-trust .logo-row img:hover{ opacity:1; }

  /* Botões mobile */
  .lp-actions .btn{ white-space:nowrap; }
  @media (max-width: 575.98px){
    .lp-actions{ gap:10px !important; }
    .lp-actions .btn{
      width:100%;
      justify-content:center;
    }
  }

  /* FAQ accordion: remove “cara de template” */
  .accordion-item{ border:1px solid var(--lp-border) !important; border-radius:12px !important; overflow:hidden; }
  .accordion-button{ font-weight:600; }
  .accordion-button:not(.collapsed){ background:#fff; color:var(--lp-ink); box-shadow:none; }

  /* Footer enterprise */
  .lp-footer{
    padding:44px 0;
    background:#0b1220;
    color:#e5e7eb;
  }
  .lp-footer a{ color:#c7d2fe; text-decoration:none; }
  .lp-footer a:hover{ text-decoration:underline; }

  /* WhatsApp FAB: menor e sem glow */
  .lp-fab{
    position:fixed; right:18px; bottom:18px; z-index:1030;
    width:52px; height:52px;
    border-radius:999px;
    display:grid; place-items:center;
    background:#22c55e; color:#fff;
    text-decoration:none;
    box-shadow:0 10px 24px rgba(0,0,0,.18);
    font-size:24px;
  }
  .lp-fab:hover{ filter:brightness(.96); color:#fff; }

  /* Seletor de idioma: discreto */
  .lp-lang{
    position:fixed; left:14px; bottom:18px; z-index:1030;
    display:flex; gap:8px;
    padding:6px;
    border-radius:999px;
    background:rgba(255,255,255,.9);
    border:1px solid rgba(229,231,235,.9);
    box-shadow:0 10px 24px rgba(0,0,0,.08);
  }
  .lp-lang .btn{
    padding:.25rem .55rem;
    border-radius:999px;
    border:1px solid var(--lp-border);
    background:#fff;
    font-weight:700;
    font-size:12px;
  }
  .lp-lang .btn.active{ background:var(--lp-primary); border-color:var(--lp-primary); color:#fff; }
  .lp-flag{ width:18px; height:18px; border-radius:999px; }
</style>
{% endblock %}

{% block content %}

{# Seletor de idioma (mantido) #}
<div class="lp-lang" aria-label="{{ _('Idioma') }}">
  {% set langs = LANGUAGES or ['pt','en','es'] %}
  {% for code,label in [('pt','PT'),('en','EN'),('es','ES')] if code in langs %}
    <a class="btn d-inline-flex align-items-center {% if (current_locale|string) == code %}active{% endif %}"
       href="{{ locale_url(code) }}">
      <img class="lp-flag"
           src="{{ url_for('static', filename='img/flags/' ~ code ~ '.svg') }}"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';"
           alt="{{ label }}">
      <span style="display:none">{{ label }}</span>
    </a>
  {% endfor %}
</div>

{% set BRAND = config.get('PUBLIC_BRAND', '4uFleet') %}
{% set MONTHLY_PRICE = (config.get('PUBLIC_MONTHLY_PRICE', 199.90) | float) %}
{% set MONTHLY_FROM = (config.get('PUBLIC_MONTHLY_FROM', 199.90) | float) %}
{% set SETUP_FROM   = (config.get('PUBLIC_SETUP_FROM', 990) | float) %}
{% set IMPLEMENT_DAYS = (config.get('PUBLIC_IMPLEMENT_DAYS', 14) | int) %}

<!-- HERO -->
<section id="hero" class="lp-hero">
  <div class="container">
    <div class="row align-items-center g-4">

      <!-- Left -->
      <div class="col-lg-7">
        <div class="mb-3">
          <img class="lp-logo"
               src="{{ url_for('static', filename='img/4ufleet-logo.png') }}"
               alt="{{ BRAND }}" decoding="async" fetchpriority="high">
        </div>

        <span class="lp-badge">
          <i class="bi bi-lightning-charge-fill"></i>
          {% trans d=IMPLEMENT_DAYS %}Implantação guiada em {{ d }} dias{% endtrans %}
        </span>

        <h1 class="lp-title">
          {{ _('Gestão de frota e reservas com operação previsível.') }}
        </h1>

        <p class="lp-lead">
          {% trans %}Controle de reservas, status dos veículos e check-in/out com evidências — com implantação acompanhada para você rodar de verdade, não só “criar conta”.{% endtrans %}
        </p>

        <div class="row g-2 mt-2">
          <div class="col-12 col-md-4">
            <div class="d-flex gap-2 align-items-start">
              <span class="lp-icon"><i class="bi bi-car-front"></i></span>
              <div>
                <div class="fw-semibold">{{ _('Status em 1 tela') }}</div>
                <div class="small text-muted">{{ _('Disponível, reservado, alugado, manutenção') }}</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="d-flex gap-2 align-items-start">
              <span class="lp-icon"><i class="bi bi-camera"></i></span>
              <div>
                <div class="fw-semibold">{{ _('Checklist com fotos') }}</div>
                <div class="small text-muted">{{ _('Menos discussão por danos') }}</div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="d-flex gap-2 align-items-start">
              <span class="lp-icon"><i class="bi bi-filetype-pdf"></i></span>
              <div>
                <div class="fw-semibold">{{ _('Contrato em PDF') }}</div>
                <div class="small text-muted">{{ _('Geração rápida e padronizada') }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="lp-actions d-flex flex-wrap gap-2 mt-4">
          <a href="#"
             class="btn btn-primary btn-lg d-inline-flex align-items-center gap-2"
             data-bs-toggle="modal"
             data-bs-target="#preSignupModal">
            <i class="bi bi-calendar2-check"></i> {{ _('Agendar demo (12 min)') }}
          </a>

          <a class="btn btn-outline-success btn-lg d-inline-flex align-items-center gap-2"
             href="https://wa.me/14072321476?text={{ _('Olá! Quero entender como funciona a implantação do 4uFleet. Podemos falar?')|urlencode }}"
             target="_blank" rel="noopener">
            <i class="bi bi-whatsapp"></i> WhatsApp
          </a>

          <button class="btn btn-outline-secondary btn-lg d-inline-flex align-items-center gap-2"
                  data-bs-toggle="modal" data-bs-target="#termsModal">
            <i class="bi bi-shield-check"></i> {{ _('Termos') }}
          </button>
        </div>

        <div class="small text-muted mt-2">
          {{ _('Implantação acompanhada • Suporte humano • Sem “autoatendimento confuso”') }}
        </div>
      </div>

      <!-- Right: Pricing -->
      <div class="col-lg-5">
        <div class="lp-card p-4">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="lp-kicker mb-1">{{ _('Plano') }}</div>
              <div class="h5 mb-0">{{ _('Pro') }}</div>
              <div class="small text-muted">{% trans d=IMPLEMENT_DAYS %}Opção de implantação em {{ d }} dias.{% endtrans %}</div>
            </div>
            <span class="badge text-bg-light border">{{ _('B2B') }}</span>
          </div>

          <div class="lp-price">
            {% trans price=('%.2f' % MONTHLY_FROM) %}US$ {{ price }}{% endtrans %}
            <span class="fs-6 fw-normal text-muted">/{{ _('mês') }}</span>
          </div>

          <hr class="my-3">

          <div class="d-grid gap-2">
            <div class="d-flex gap-2">
              <i class="bi bi-check2 text-success"></i>
              <div class="small">{{ _('Reservas e calendário operacional') }}</div>
            </div>
            <div class="d-flex gap-2">
              <i class="bi bi-check2 text-success"></i>
              <div class="small">{{ _('Status de frota e manutenção') }}</div>
            </div>
            <div class="d-flex gap-2">
              <i class="bi bi-check2 text-success"></i>
              <div class="small">{{ _('Checklists com evidências (fotos + assinatura)') }}</div>
            </div>
            <div class="d-flex gap-2">
              <i class="bi bi-check2 text-success"></i>
              <div class="small">{{ _('Contrato PDF e rastreabilidade') }}</div>
            </div>
          </div>

          <div class="lp-card-soft p-3 mt-3">
            <div class="small">
              <strong>{{ _('Implantação guiada (opcional):') }}</strong>
              {% trans setup=('%.0f' % SETUP_FROM) %}a partir de US$ {{ setup }} (pagamento único).{% endtrans %}
              <span class="text-muted">{{ _('Configuração + importação + treinamento.') }}</span>
            </div>
          </div>

          <a class="btn btn-primary btn-lg w-100 mt-3"
             href="#"
             data-bs-toggle="modal"
             data-bs-target="#preSignupModal">
            {{ _('Quero a demo') }}
          </a>

          <div class="small text-muted mt-2">
            {{ _('Se você não operar processo, nenhum software salva. A gente implementa com você.') }}
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- TRUST BAR -->
<section class="lp-trust">
  <div class="container">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
      <div class="small text-muted">{{ _('Criado para locadoras independentes e operações enxutas.') }}</div>
      <div class="logo-row d-flex align-items-center gap-4 flex-wrap justify-content-center">
        <img src="{{ url_for('static', filename='img/brand1.png') }}" alt="" onerror="this.style.display='none'">
        <img src="{{ url_for('static', filename='img/brand2.png') }}" alt="" onerror="this.style.display='none'">
        <img src="{{ url_for('static', filename='img/brand3.png') }}" alt="" onerror="this.style.display='none'">
        <img src="{{ url_for('static', filename='img/brand4.png') }}" alt="" onerror="this.style.display='none'">
      </div>
    </div>
  </div>
</section>

<!-- FEATURES -->
<section id="features" class="lp-section">
  <div class="container">
    <div class="row mb-4 align-items-end g-2">
      <div class="col-lg-8">
        <div class="lp-kicker">{{ _('Recursos') }}</div>
        <h2 class="mb-1">{{ _('O essencial para rodar sem caos') }}</h2>
        <p class="text-muted mb-0">{{ _('Menos improviso, mais previsibilidade operacional.') }}</p>
      </div>
      <div class="col-lg-4 text-lg-end">
        <a href="#" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#preSignupModal">
          {{ _('Ver na demo') }}
        </a>
      </div>
    </div>

    {% set features = [
      ('bi-calendar3',_('Calendário de reservas'),_('Visão clara de entregas, devoluções e bloqueios.')),
      ('bi-car-front',_('Status da frota'),_('Controle simples e objetivo do ciclo do veículo.')),
      ('bi-clipboard2-check',_('Check-in/out padronizado'),_('Checklist com fotos e assinatura para reduzir disputa.')),
      ('bi-filetype-pdf',_('Contrato em PDF'),_('Modelos e geração rápida no fluxo da operação.')),
      ('bi-envelope-paper',_('Comunicação'),_('Notificações e e-mails transacionais por tenant.')),
      ('bi-shield-check',_('Auditoria'),_('Rastreabilidade do que foi feito e por quem.'))
    ] %}

    <div class="row g-3">
      {% for icon, title, desc in features %}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="lp-card h-100 p-4">
          <div class="d-flex gap-3">
            <span class="lp-icon"><i class="bi {{ icon }}"></i></span>
            <div>
              <div class="fw-semibold">{{ title }}</div>
              <div class="text-muted small">{{ desc }}</div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- HOW IT WORKS -->
<section id="how-it-works" class="lp-section" style="background: var(--lp-bg-soft); border-top:1px solid var(--lp-border); border-bottom:1px solid var(--lp-border);">
  <div class="container">
    <div class="row g-4 align-items-center">
      <div class="col-lg-6">
        <div class="lp-kicker">{{ _('Como funciona') }}</div>
        <h2 class="mb-2">{{ _('Implantação simples, operação consistente') }}</h2>
        <p class="text-muted mb-3">
          {% trans d=IMPLEMENT_DAYS %}A gente configura, importa e treina — para você rodar em até {{ d }} dias com um fluxo padrão.{% endtrans %}
        </p>

        <div class="d-grid gap-2">
          <div class="lp-card p-3">
            <div class="d-flex gap-3">
              <span class="lp-icon"><strong>1</strong></span>
              <div>
                <div class="fw-semibold">{{ _('Demo rápida') }}</div>
                <div class="small text-muted">{{ _('Você mostra como opera hoje. A gente mapeia seu fluxo.') }}</div>
              </div>
            </div>
          </div>
          <div class="lp-card p-3">
            <div class="d-flex gap-3">
              <span class="lp-icon"><strong>2</strong></span>
              <div>
                <div class="fw-semibold">{{ _('Configuração + importação') }}</div>
                <div class="small text-muted">{{ _('Veículos, clientes, regras e modelos prontos.') }}</div>
              </div>
            </div>
          </div>
          <div class="lp-card p-3">
            <div class="d-flex gap-3">
              <span class="lp-icon"><strong>3</strong></span>
              <div>
                <div class="fw-semibold">{{ _('Treinamento e go-live') }}</div>
                <div class="small text-muted">{{ _('Equipe operando com checklist, contrato e status.') }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex flex-wrap gap-2 mt-3">
          <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#preSignupModal">{{ _('Agendar demo') }}</a>
          <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#termsModal">{{ _('Termos') }}</button>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="lp-card p-4">
          <div class="lp-kicker">{{ _('O que você ganha') }}</div>
          <ul class="mb-0 text-muted">
            <li class="mb-2">{{ _('Menos conflito de reserva e menos “carro sumido”.') }}</li>
            <li class="mb-2">{{ _('Redução de discussão por danos com evidência.') }}</li>
            <li class="mb-2">{{ _('Padronização do check-in/out para treinar equipe rápido.') }}</li>
            <li class="mb-0">{{ _('Visão operacional diária sem depender de “quem sabe”.') }}</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- TESTIMONIALS (clean) -->
<section id="testimonials" class="lp-section">
  <div class="container">
    <div class="row mb-4 g-2 align-items-end">
      <div class="col-lg-8">
        <div class="lp-kicker">{{ _('Clientes') }}</div>
        <h2 class="mb-1">{{ _('Resultados no dia a dia') }}</h2>
        <p class="text-muted mb-0">{{ _('Sem exagero. Operação mais previsível.') }}</p>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-12 col-lg-4">
        <div class="lp-card p-4 h-100">
          <p class="mb-3">“{{ _('O check-in com fotos reduziu discussão e prejuízo. A implantação foi objetiva.') }}”</p>
          <div class="small text-muted">Carla M. — {{ _('Sócia, JetCar') }}</div>
        </div>
      </div>
      <div class="col-12 col-lg-4">
        <div class="lp-card p-4 h-100">
          <p class="mb-3">“{{ _('Parei de ter conflito de reserva. Hoje eu vejo o status sem perguntar pra ninguém.') }}”</p>
          <div class="small text-muted">Rafael T. — {{ _('Gerente, EasyDrive') }}</div>
        </div>
      </div>
      <div class="col-12 col-lg-4">
        <div class="lp-card p-4 h-100">
          <p class="mb-3">“{{ _('Contrato + checklist virou rotina. A equipe entrou no ritmo rápido.') }}”</p>
          <div class="small text-muted">Bianca A. — {{ _('Owner, BlueRent') }}</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FAQ -->
<section id="faq" class="lp-section" style="background: var(--lp-bg-soft); border-top:1px solid var(--lp-border);">
  <div class="container">
    <div class="text-center mb-4">
      <div class="lp-kicker">{{ _('Dúvidas') }}</div>
      <h2 class="mb-1">{{ _('Perguntas frequentes') }}</h2>
      <p class="text-muted mb-0">{{ _('Direto ao ponto.') }}</p>
    </div>

    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="accordion" id="faqAcc">
          <div class="accordion-item mb-2">
            <h2 class="accordion-header">
              <button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#q1">
                {{ _('O que é “implantação guiada”?') }}
              </button>
            </h2>
            <div id="q1" class="accordion-collapse collapse show" data-bs-parent="#faqAcc">
              <div class="accordion-body text-muted">
                {% trans d=IMPLEMENT_DAYS %}A gente configura seu ambiente, importa dados e treina sua equipe. O objetivo é rodar de verdade em até {{ d }} dias — não só “criar conta”.{% endtrans %}
              </div>
            </div>
          </div>

          <div class="accordion-item mb-2">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#q2">
                {{ _('Preciso pagar taxa de implantação?') }}
              </button>
            </h2>
            <div id="q2" class="accordion-collapse collapse" data-bs-parent="#faqAcc">
              <div class="accordion-body text-muted">
                {{ _('A implantação guiada é opcional e recomendada quando você quer reduzir risco e acelerar go-live.') }}
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#q3">
                {{ _('Tem limite de frota ou usuários?') }}
              </button>
            </h2>
            <div id="q3" class="accordion-collapse collapse" data-bs-parent="#faqAcc">
              <div class="accordion-body text-muted">
                {{ _('Na demo, a gente recomenda o melhor encaixe pelo tamanho da frota e da operação.') }}
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mt-4">
          <a href="#" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#preSignupModal">
            {{ _('Agendar demo') }}
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="lp-footer">
  <div class="container">
    <div class="row g-4">
      <div class="col-12 col-md-4">
        <div class="fw-semibold">{{ BRAND }}</div>
        <div class="small opacity-75 mt-1">© {{ BRAND }} — {{ config.get('APP_NAME', 'Car Rental SaaS') }}</div>
        <div class="small opacity-75">{{ _('SaaS com opção de implantação guiada.') }}</div>
      </div>

      <div class="col-6 col-md-2">
        <div class="fw-semibold mb-2">{{ _('Produto') }}</div>
        <ul class="list-unstyled small mb-0">
          <li class="mb-1"><a href="#features">{{ _('Recursos') }}</a></li>
          <li class="mb-1"><a href="#how-it-works">{{ _('Como funciona') }}</a></li>
          <li><a href="#faq">{{ _('FAQ') }}</a></li>
        </ul>
      </div>

      <div class="col-6 col-md-3">
        <div class="fw-semibold mb-2">{{ _('Suporte') }}</div>
        <ul class="list-unstyled small mb-0">
          <li class="mb-1"><a href="https://wa.me/14072321476" target="_blank" rel="noopener">WhatsApp</a></li>
          <li class="mb-1"><a href="tel:+14072321476">{{ _('Telefone') }}</a></li>
          <li><a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">{{ _('Termos de uso') }}</a></li>
        </ul>
      </div>

      <div class="col-12 col-md-3">
        <div class="fw-semibold mb-2">{{ _('Ação') }}</div>
        <a href="#" class="btn btn-light btn-sm w-100 mb-2" data-bs-toggle="modal" data-bs-target="#preSignupModal">
          {{ _('Agendar demo') }}
        </a>
        <a href="#" class="btn btn-outline-light btn-sm w-100" data-bs-toggle="modal" data-bs-target="#termsModal">
          {{ _('Termos de uso') }}
        </a>
      </div>
    </div>
  </div>
</footer>

<!-- MODAIS (mantidos) -->
<div class="modal fade" id="preSignupModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="preSignupForm">
        {{ csrf_field() }}
        <div class="modal-header">
          <h5 class="modal-title">{{ _('Agende uma demo e receba acesso') }}</h5>
          <button class="btn-close" data-bs-dismiss="modal" type="button" aria-label="{{ _('Fechar') }}"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">{{ _('Seu nome') }}</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">{{ _('Telefone') }}</label>
            <input type="tel" name="phone" class="form-control" placeholder="+1 407...">
          </div>
          <div class="mb-3">
            <label class="form-label">{{ _('E-mail') }}</label>
            <input type="email" name="email" class="form-control" required>
          </div>

          <div class="small text-muted">
            {{ _('Vamos enviar um e-mail com o link de acesso e, se você informou telefone, podemos te chamar no WhatsApp para agendar a demo.') }}
            <a href="#" id="preSignupOpenTerms" class="link-primary ms-1">{{ _('Ver Termos de Uso') }}</a>
          </div>

          <div id="preSignupAlert" class="alert d-none mt-3" role="alert"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">{{ _('Cancelar') }}</button>
          <button class="btn btn-primary" id="preSignupSubmitBtn" type="submit">{{ _('Enviar') }}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="termsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ _('Termos de uso — Assinatura Pro %(brand)s', brand=BRAND) }}</h5>
        <button class="btn-close" data-bs-dismiss="modal" aria-label="{{ _('Fechar') }}"></button>
      </div>
      <div class="modal-body">
        <ul class="text-muted">
          <li><strong class="text-dark">{{ _('Período de teste:') }}</strong> {{ _('15 dias com acesso completo (quando aplicável). O teste inicia na ativação da conta.') }}</li>
          <li><strong class="text-dark">{{ _('Cobrança:') }}</strong> {% trans price=("%.2f"|format(MONTHLY_PRICE)) %}após o teste, a assinatura continua por US$ {{ price }}/mês, recorrente.{% endtrans %}</li>
          <li><strong class="text-dark">{{ _('Cancelamento:') }}</strong> {{ _('você pode cancelar a qualquer momento pelo painel. O acesso permanece até o fim do ciclo vigente.') }}</li>
          <li><strong class="text-dark">{{ _('Limites:') }}</strong> {{ _('aplicam-se limites técnicos de uso justo (armazenamento de fotos, e-mails etc.).') }}</li>
          <li><strong class="text-dark">{{ _('Implantação guiada:') }}</strong> {{ _('serviço opcional e cobrado à parte, conforme escopo e tamanho da frota.') }}</li>
          <li><strong class="text-dark">{{ _('Privacidade:') }}</strong> {{ _('seguimos boas práticas de proteção de dados; consulte a Política de Privacidade.') }}</li>
          <li><strong class="text-dark">{{ _('Suporte:') }}</strong> {{ _('atendimento por e-mail/WhatsApp; prazos podem variar conforme demanda.') }}</li>
          <li><strong class="text-dark">{{ _('Atualizações:') }}</strong> {{ _('podemos atualizar estes termos a qualquer momento.') }}</li>
        </ul>
        <p class="small text-muted mb-0">{{ _('Dúvidas? Fale conosco!') }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="termsGoSignup">{{ _('Agendar demo') }}</button>
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">{{ _('Fechar') }}</button>
      </div>
    </div>
  </div>
</div>

{# Mantido por compatibilidade #}
<div class="modal fade" id="videoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-black">
      <div class="ratio ratio-16x9">
        <iframe id="demoVideo" src="about:blank"
                title="4uFleet Demo" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>
    </div>
  </div>
</div>

{% set WHATS_MSG = _("Olá! Tenho dúvidas sobre a implementação do 4uFleet. Podemos falar?") %}
<a class="lp-fab"
   href="https://wa.me/14072321476?text={{ WHATS_MSG|urlencode }}"
   title="{{ _('Falar no WhatsApp') }}"
   target="_blank" rel="noopener" aria-label="WhatsApp">
  <i class="bi bi-whatsapp"></i>
</a>

{% endblock %}

{% block extra_js %}
<script>
  const I18N = {
    sending: {{ _('Enviando...')|tojson }},
    success: {{ _('Pronto! Enviamos um e-mail com o link de acesso. Se você informou telefone, podemos te chamar no WhatsApp para agendar a demo.')|tojson }},
    warn:    {{ _('Não foi possível enviar agora.')|tojson }},
    neterr:  {{ _('Falha de rede. Tente novamente.')|tojson }}
  };

  // parar o vídeo ao fechar (mantido)
  const videoModal = document.getElementById('videoModal');
  videoModal?.addEventListener('hidden.bs.modal', () => {
    const iframe = document.getElementById('demoVideo');
    if(iframe){ iframe.src = iframe.src; }
  });

  // pré-signup (mantido)
  (function(){
    const form   = document.getElementById('preSignupForm');
    const alertB = document.getElementById('preSignupAlert');
    const btn    = document.getElementById('preSignupSubmitBtn');

    function showAlert(kind, msg){
      alertB.className = 'alert alert-' + kind;
      alertB.textContent = msg;
      alertB.classList.remove('d-none');
    }

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      alertB.classList.add('d-none');
      btn.disabled = true; btn.textContent = I18N.sending;

      try {
        const fd = new FormData(form);
        const resp = await fetch('{{ url_for("site.pre_signup") }}', { method:'POST', body: fd });
        const data = await resp.json().catch(()=>({}));

        if (resp.ok && data.ok){
          showAlert('success', I18N.success);
          form.reset();
          setTimeout(() => {
            const m = bootstrap.Modal.getInstance(document.getElementById('preSignupModal'));
            m && m.hide();
          }, 1400);
        } else {
          showAlert('warning', (data && data.error) || I18N.warn);
        }
      } catch (err) {
        showAlert('danger', I18N.neterr);
      } finally {
        btn.disabled = false; btn.textContent = {{ _('Enviar')|tojson }};
      }
    });
  })();

  // Termos -> abrir pré-signup (mantido)
  (function(){
    const btn = document.getElementById('termsGoSignup');
    if(!btn) return;

    btn.addEventListener('click', () => {
      const terms = document.getElementById('termsModal');
      const pre   = document.getElementById('preSignupModal');

      const openPre = () => {
        bootstrap.Modal.getOrCreateInstance(pre).show();
        terms.removeEventListener('hidden.bs.modal', openPre);
      };

      bootstrap.Modal.getOrCreateInstance(terms).hide();
      terms.addEventListener('hidden.bs.modal', openPre);
    });
  })();

  // PreSignup -> abrir termos (sem empilhar)
  (function(){
    const a = document.getElementById('preSignupOpenTerms');
    if(!a) return;

    a.addEventListener('click', (e) => {
      e.preventDefault();
      const pre = document.getElementById('preSignupModal');
      const terms = document.getElementById('termsModal');

      const openTerms = () => {
        bootstrap.Modal.getOrCreateInstance(terms).show();
        pre.removeEventListener('hidden.bs.modal', openTerms);
      };

      bootstrap.Modal.getOrCreateInstance(pre).hide();
      pre.addEventListener('hidden.bs.modal', openTerms);
    });
  })();
</script>
{% endblock %}
